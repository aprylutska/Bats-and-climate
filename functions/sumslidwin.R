# Custom function to calculate sum of variable (xvar) in retrospective sliding window# data: data frame with at least two columns:# xvar: column containing target variable# datevar: column containing dates in POSIX format# time_lag: width of time window in dayssumslidwin <- function(data, datevar, xvar, time_lag) {  # For sliding means calculations  library(zoo)    # convert bare, unquoted column names to strings, to pass them to   # classic R expressions  xvar_sbs <- deparse(substitute(xvar))  datevar_sbs <- deparse(substitute(datevar))    # Cut down the date range to a respective year  daily.one.event <- data %>%     # Reorder by decreasing date    arrange(desc({{datevar}})) %>%     # Only current year left    filter(year({{datevar}}) == max(year({{datevar}})))    # Calculate Rolling Mean for specified variable  # Create a zoo object with Date as the index  zoo_data <- zoo(daily.one.event[[xvar_sbs]],                  order.by = daily.one.event[[datevar_sbs]])    # Calculate rolling mean with a time window, specified in   # "time_lag" arguments (in days)  rolling_mean <- rollapply(zoo_data, width = time_lag,                             FUN = sum, align = "right", fill = NA)    # Convert the result back to a data frame  rolling_mean_df <- data.frame(date = index(rolling_mean),                                 Rolling_Mean_Var = coredata(rolling_mean))    # Sort the resulting data frame by Date in descending order  rolling_mean_df <- rolling_mean_df[order(rolling_mean_df[[datevar_sbs]],                                            decreasing = TRUE), ]  # each mean value corresponds to the last day of the time window    # Cut by fixed dates  # July 1st  # Define day of year for the July 1st for the year of event  july_1st <- yday(paste0(year(daily.one.event[[datevar_sbs]][1]), "-07-01"))    # Define day of year for the July 1st for the year of event  mar_1st <- yday(paste0(year(daily.one.event[[datevar_sbs]][1]), "-03-01"))    rolling_mean_df <- rolling_mean_df %>%     mutate(doy = yday({{datevar}})) %>%     filter(doy <= july_1st & doy >= mar_1st) %>%     select(-doy)    Rolling_Mean_Variable <- rolling_mean_df[,2]  return(Rolling_Mean_Variable)}